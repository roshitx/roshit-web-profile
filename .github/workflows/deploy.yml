name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout Repo
        uses: actions/checkout@v3

      - name: üöÄ Deploy to VPS
        id: deploy
        uses: appleboy/ssh-action@v0.1.7
        with:
          host: ${{ secrets.VPS_HOST }}
          username: roshit
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            bash ~/project/roshit-web-profile/deploy/deploy-web.sh

      - name: ‚úÖ Notify Telegram on Success
        if: success()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ‚úÖ *Deploy Sukses*
            Project: roshit-web-profile
            VPS: ${{ secrets.VPS_HOST }}
            Branch: main
            Time: ${{ github.event.head_commit.timestamp }}

      - name: ‚ùå Notify Telegram on Failure
        if: failure()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ‚ùå *Deploy GAGAL*
            Cek CI log di GitHub Actions
            VPS: ${{ secrets.VPS_HOST }}
            Branch: main
